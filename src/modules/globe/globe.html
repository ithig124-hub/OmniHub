<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Globe Module</title>
  <!-- Global Theme Integration -->
  <link rel="stylesheet" href="../../core/themeIntegration.css">
  <link rel="stylesheet" href="globe.css">
</head>
<body>
  <!-- Main Globe Container -->
  <div id="globe-container">
    <!-- Globe renders here -->
  </div>

  <!-- Zoom Level Indicator -->
  <div id="zoom-level-indicator" class="glass-panel" style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); padding: 10px 20px; z-index: 100;">
    <span id="zoom-level-text">Zoom: Planetary</span>
  </div>

  <!-- UNIFIED RESEARCH & CONTROLS PANEL (Consolidated) -->
  <div id="unified-panel" class="glass-panel unified-research-panel" data-testid="unified-research-panel">
    <!-- Panel Header with Toggle -->
    <div class="panel-header">
      <h2>ğŸ”¬ Research Hub</h2>
      <button id="toggle-panel-btn" class="collapse-btn" data-testid="toggle-panel-btn">âˆ’</button>
    </div>

    <div id="panel-content" class="panel-content">
      <!-- Search Section -->
      <div class="panel-section">
        <h3>ğŸ” Search</h3>
        <div class="search-box">
          <input type="text" id="search-input" placeholder="Search location, country, city..." data-testid="search-input">
          <button id="search-btn" data-testid="search-btn">Go</button>
        </div>
        <div id="search-results" data-testid="search-results"></div>
      </div>

      <!-- Live Flights Section -->
      <div class="panel-section">
        <h3>âœˆï¸ Live Flights</h3>
        <div class="flight-controls">
          <button id="toggle-live-flights-btn" class="tool-btn" data-testid="toggle-live-flights-btn">
            ğŸ›« Start Live Tracking
          </button>
          <div id="flight-count" data-testid="flight-count" style="margin-top: 8px; font-size: 0.9rem; opacity: 0.8;">
            No active flights
          </div>
        </div>
      </div>

      <!-- Layers Section (Collapsible) -->
      <div class="panel-section collapsible">
        <h3 class="section-toggle" data-section="layers">
          ğŸŒ Layers <span class="toggle-icon">â–¼</span>
        </h3>
        <div class="section-content" id="layers-content">
          <div class="layer-item">
            <input type="checkbox" id="layer-ocean" data-testid="layer-ocean-toggle">
            <label for="layer-ocean">ğŸŒŠ Ocean Data</label>
            <input type="range" id="opacity-ocean" min="0" max="100" value="70" class="opacity-slider">
          </div>
          <div class="layer-item">
            <input type="checkbox" id="layer-grid" data-testid="layer-grid-toggle">
            <label for="layer-grid">ğŸ§­ Coordinate Grid</label>
          </div>
          <div class="layer-item">
            <input type="checkbox" id="layer-atmosphere" checked data-testid="layer-atmosphere-toggle">
            <label for="layer-atmosphere">â˜ï¸ Atmosphere</label>
          </div>
        </div>
      </div>

      <!-- Research Tools Section (Collapsible) -->
      <div class="panel-section collapsible">
        <h3 class="section-toggle" data-section="research-tools">
          ğŸ”¬ Research Tools <span class="toggle-icon">â–¼</span>
        </h3>
        <div class="section-content collapsed" id="research-tools-content">
          <button id="toggle-research-btn" class="tool-btn">ğŸ”¬ Research Mode</button>
          <div id="research-mode-status" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.7;">
            Click to activate advanced measurement tools
          </div>
        </div>
      </div>

      <!-- Saved Pins Section (Collapsible) -->
      <div class="panel-section collapsible">
        <h3 class="section-toggle" data-section="pins">
          ğŸ“ Saved Pins <span class="toggle-icon">â–¼</span>
        </h3>
        <div class="section-content collapsed" id="pins-content">
          <div id="pins-container"></div>
        </div>
      </div>

      <!-- Export Section (Collapsible) -->
      <div class="panel-section collapsible">
        <h3 class="section-toggle" data-section="export">
          ğŸ’¾ Export Data <span class="toggle-icon">â–¼</span>
        </h3>
        <div class="section-content collapsed" id="export-content">
          <div class="export-buttons">
            <button onclick="window.DataExporter.downloadData('json')" data-testid="export-json-btn" class="export-btn">JSON</button>
            <button onclick="window.DataExporter.downloadData('csv')" data-testid="export-csv-btn" class="export-btn">CSV</button>
            <button onclick="window.DataExporter.downloadData('geojson')" data-testid="export-geojson-btn" class="export-btn">GeoJSON</button>
            <button onclick="window.DataExporter.downloadData('kml')" data-testid="export-kml-btn" class="export-btn">KML</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom-Left Info Panel -->
  <div id="info-panel" class="glass-panel" data-testid="globe-info-panel">
    <div id="coordinates-display">
      <span id="lat-display" data-testid="lat-display">Lat: --</span>
      <span id="lng-display" data-testid="lng-display">Lng: --</span>
    </div>
    <div id="location-info" data-testid="location-info">
      <p>Hover over Earth to see coordinates</p>
    </div>
  </div>

  <!-- Pin Detail Modal -->
  <div id="pin-modal" class="modal hidden" data-testid="pin-modal">
    <div class="modal-content glass-panel">
      <span class="close-btn" data-testid="pin-modal-close">&times;</span>
      <h2 id="modal-title">Location Details</h2>
      <div id="modal-body">
        <p><strong>Coordinates:</strong> <span id="modal-coords"></span></p>
        <p><strong>Country:</strong> <span id="modal-country"></span></p>
        <p><strong>Region:</strong> <span id="modal-region"></span></p>
        <p><strong>Population:</strong> <span id="modal-population"></span></p>
        <div id="modal-description"></div>
      </div>
      <div class="modal-actions">
        <button id="save-pin-btn" data-testid="save-pin-btn">ğŸ“ Save Pin</button>
        <button id="close-modal-btn" data-testid="close-modal-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Flight Details Modal (New) -->
  <div id="flight-details-modal" class="modal hidden" data-testid="flight-details-modal">
    <!-- Content generated dynamically -->
  </div>

  <!-- Loading Indicator -->
  <div id="globe-loader" class="loader hidden">
    <div class="spinner"></div>
    <p>Loading Globe...</p>
  </div>

  <!-- Scripts - LOCAL LIBRARIES FOR ELECTRON COMPATIBILITY -->
  <!-- Global Theme -->
  <script src="../../core/globalTheme.js"></script>
  
  <!-- Core Libraries -->
  <script src="libs/three.min.js"></script>
  <script src="libs/globe.gl.min.js"></script>
  <script src="libs/d3.min.js"></script>
  
  <!-- Globe Core -->
  <script src="globeState.js"></script>
  <script src="data/staticDatasets.js"></script>
  <script src="layers/flights.js"></script>
  <!-- Shipping layer removed - using AviationStack flight API instead -->
  <!-- <script src="layers/shipping.js"></script> -->
  <script src="layers/oceans.js"></script>
  
  <!-- Advanced Features -->
  <script src="zoomIntelligence.js"></script>
  <script src="dataAdapters.js"></script>
  <script src="smartPins.js"></script>
  <script src="overlayManager.js"></script>
  <script src="researchMode.js"></script>
  <script src="annotationSystem.js"></script>
  <script src="dataExporter.js"></script>
  <script src="flightTracker.js"></script>
  
  <!-- Main Globe -->
  <script src="globe.js"></script>
  
  <!-- Theme Integration -->
  <script>
    // Subscribe to global theme changes
    if (window.GlobalTheme) {
      window.GlobalTheme.subscribe((theme) => {
        console.log('ğŸŒ Globe received theme update:', theme);
        // Globe automatically uses CSS variables
      });
    }
  </script>
</body>
</html>
